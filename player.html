<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
    <meta name="renderer" content="webkit">
    <meta name="author" content="">
    <meta name="generator" content="KodCloud">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    
    <!-- 强制移动设备以app模式打开页面(即在移动设备下全屏，仅支持部分浏览器) -->
    <!-- <meta name="apple-mobile-web-app-capable" content="yes"> -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="full-screen" content="yes"><!--UC强制全屏-->
    <meta name="browsermode" content="application"><!--UC应用模式-->
    <meta name="x5-fullscreen" content="true"><!--QQ强制全屏-->
    <meta name="x5-page-mode" content="app"><!--QQ应用模式-->
    
    <title>Music Online Player</title>
    
    <!-- 不支持IE8及以下版本浏览器 -->
    <!--[if lte IE 8]>
        <script>window.location.href="plugins/killie/"</script>
    <![endif]--> 
    
    <!-- favicon图标 -->
    <link rel="shortcut icon" href="favicon.ico">
    
    <!-- jQuery文件 -->
    <script src="js/jquery.min.js"></script>
    
    <!-- 播放器样式表文件 -->
    <link rel="stylesheet" type="text/css" href="css/player.css">
    
    <!-- 小屏幕样式修复 -->
    <!-- <link rel="stylesheet" type="text/css" href="css/small.css"> -->
    
    <!-- 滚动条美化样式文件 -->
    <!-- <link rel="stylesheet" type="text/css" href="css/jquery.mCustomScrollbar.min.css"> -->
    
    <!-- layer弹窗插件样式文件 -->
    <!-- <link rel="stylesheet" href="plugins/layer/skin/default/layer.css?v=3.0.2302" id="layuicss-skinlayercss"> -->

    <style>
        .audioPlayer {
            position: relative;
            top: 50%;  
            left: 15%;
            /* transform: translate(-50%, -50%);  */
        }
    </style>

</head>
<body>
    <div class="audioPlayer">
    <audio id='audio' controls autoplay>
        <source id='mp3source' src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
    </div>

<!-- layer弹窗插件 -->
<!-- <script src="plugins/layer/layer.js"></script> -->

<!-- 播放器数据加载模块 -->
<!-- <script src="js/ajax.js"></script> -->

<!-- 播放器歌词解析模块 -->
<!-- <script src="js/lyric.js"></script> -->

<!-- 音乐列表配置 -->
<!-- <script src="js/musicList2.js"></script> -->

<!-- 封装函数及ui交互模块 -->
<!-- <script src="js/functions.js"></script> -->

<!-- 播放器主体功能模块 -->
<!-- <script src="js/player.js"></script> -->

<!-- 滚动条美化插件 -->
<!-- <script src="js/jquery.mCustomScrollbar.concat.min.js"></script> -->

<!-- 背景模糊化插件 -->
<!-- <script src="js/background-blur.min.js"></script> -->


<script>


function KuwoUrl(id, callback) {
    // console.log(id);
    fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent("https://pkjstudio.pythonanywhere.com/kuwo/" + id)}`)
    .then(response => {
        if (response.ok) return response.text()
        throw new Error('Network response was not ok.')
    })
    .then(data => {
        var kuwoDES = data;
        fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent("http://mobi.kuwo.cn/mobi.s?f=kuwo&q=" + kuwoDES)}`)
        .then(response => {
            if (response.ok) return response.text()
            throw new Error('Network response was not ok.')
        })
        .then(data => {
            var j = data;
            // console.log(j);
            if (j.includes("url=")) {
                mp3Url = j.split("url=")[1].split("?")[0];
                // console.log(mp3Url);
                var audio = document.getElementById('audio');
                var source = document.getElementById('mp3source');
                source.src = mp3Url;
                audio.load(); //call this to just preload the audio without playing
                audio.play(); //call this to play the song right away                
                if (callback) callback(mp3Url);
            }
        });    
        

    });
}


function MVUrl(id,callback)
{
    $.ajax({ 
        type: 'GET', 
        url: 'https://cors-anywhere.herokuapp.com/https://music.163.com/mv',
        data: "id=" + id,
		contentType : 'application/json; charset=utf-8',
        dataType : "html",
        success: function(result){
            if (result.includes('data-flashvars="hurl=&murl=')){
                var s0 = result.split('data-flashvars="hurl=&murl=');
    			var s1 = s0[1].split('&');
            } else if (result.includes('data-flashvars="hurl=')){
                var s0 = result.split('data-flashvars="hurl=');
    			var s1 = s0[1].split('&murl=');
            }
			var url = decodeURIComponent(s1[0]);
            console.log(url);
			//document.write(url);
			location.href = url;
            return true;
        },
        error: function(XMLHttpRequest, textStatus, errorThrown) {
            console.log(XMLHttpRequest + textStatus + errorThrown);
        }
    }); 
    
}


    // get params
    (window.onpopstate = function () {
        var match,
            pl     = /\+/g,  // Regex for replacing addition symbol with a space
            search = /([^&=]+)=?([^&]*)/g,
            decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
            query  = window.location.search.substring(1);

        urlParams = {};
        while (match = search.exec(query))
            urlParams[decode(match[1])] = decode(match[2]);
    })();

    if (urlParams["id"] != null) { 
        id = urlParams["id"];
        // MVUrl(id);
        KuwoUrl(id);
    }

</script>

</body>
</html>